<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configure Event-Driven to pass extra variables to Ansible Automation Platform :: Product Enablement: Event-Driven Ansible Troubleshooting Lab</title>
    <link rel="prev" href="section2.html">
    <link rel="next" href="section4.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Product Enablement: Event-Driven Ansible Troubleshooting Lab</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/troubleshooting-eda/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="troubleshooting-eda" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Product Enablement: Event-Driven Ansible Troubleshooting Lab</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Product Enablement: Event-Driven Ansible Troubleshooting Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">Troubleshooting the rulebook using CURL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Troubleshoot rulebook using CURL and extra_vars</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section3.html">Configure Event-Driven to pass extra variables to Ansible Automation Platform</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section4.html">Configure Event-Driven to pass extra variables to Ansible Automation Platform</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section5.html">Let&#8217;s configure Event-Driven and Ansible Automation Platform to fix issues coming from Zabbix</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Product Enablement: Event-Driven Ansible Troubleshooting Lab</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Product Enablement: Event-Driven Ansible Troubleshooting Lab</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Product Enablement: Event-Driven Ansible Troubleshooting Lab</a></li>
    <li><a href="section3.html">Configure Event-Driven to pass extra variables to Ansible Automation Platform</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configure Event-Driven to pass extra variables to Ansible Automation Platform</h1>
<div class="sect1">
<h2 id="in_this_bfx"><a class="anchor" href="#in_this_bfx"></a>What is in this break-fix</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, you will configure Ansible Automation Platform to receive events from Event-Driven Ansible (Automation Decisions). After sending the curl command with the host parameters, you need to validate if the Job Template <em>redhat-aap-extra-vars-eda</em> will execute with the Event-Driven Ansible (Automation Decisions) event.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lets_copy_the_files"><a class="anchor" href="#_lets_copy_the_files"></a>Let&#8217;s copy the files:</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On <strong>node1</strong> let&#8217;s list the files in the <em>.ssh/</em> folder and view your public key.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">ssh node1
ls -lha ~/.ssh/
cat ~/.ssh/n66g5key.pub # (Change to your ssh pub key)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>[lab-user@bastion ~]$ ssh node1
[ec2-user@node1 ~]$ ls -lha ~/.ssh/
total 36K
drwx------.  2 ec2-user ec2-user  157 Nov 26 14:23 .
drwx------. 10 ec2-user ec2-user 4.0K Nov 26 14:05 ..
-rw-------.  1 ec2-user ec2-user 3.1K Nov 26 13:21 authorized_keys
-r--------.  1 ec2-user ec2-user  216 Nov 26 14:02 config
-rw-------.  1 ec2-user ec2-user 2.6K Nov 26 13:47 id_rsa
-rw-------.  1 ec2-user ec2-user  582 Nov 26 13:47 id_rsa.pub
-rw-------.  1 ec2-user ec2-user 1.7K Nov 26 14:23 known_hosts
-rw-------.  1 ec2-user ec2-user  913 Nov 26 14:21 known_hosts.old
-r--------.  1 ec2-user ec2-user 2.6K Nov 26 14:22 n66g5key.pem
-r--------.  1 ec2-user ec2-user  552 Nov 26 14:22 n66g5key.pub
[ec2-user@node1 ~]$ cat ~/.ssh/n66g5key.pub (Change to your ssh pub key)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the contents of the public key and add it to this link. To do this you will need to hold the <strong>Shift</strong> key, and then highlight the key and right click to copy.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-git.png" target="_blank" rel="noopener"><img src="_images/lab003-git.png" alt="lab003-git" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to User Settings -&#8594; Preferences -&#8594; SSH keys</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-git002.png" target="_blank" rel="noopener"><img src="_images/lab003-git002.png" alt="lab003-git002" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You will need to open and log in to the GitLab server using the username <code>root</code> and password: <code>redhat..123</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-add002.jpg" target="_blank" rel="noopener"><img src="_images/lab003-add002.jpg" alt="lab003-add002" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Add new key</strong> and paste the public key into the <strong>"Key"</strong> box. Give it a title and click <strong>Add key</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-add004.jpg" target="_blank" rel="noopener"><img src="_images/lab003-add004.jpg" alt="lab003-add004" width="100%" height="100%"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-add005.jpg" target="_blank" rel="noopener"><img src="_images/lab003-add005.jpg" alt="lab003-add005" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On <strong>node1</strong>, pull the <em>redhat-aap-extra-vars-eda</em> repository and copy both folders into <em>redhat-aap-extra-vars-eda</em>:</p>
</li>
</ul>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cd 03-lab/
git clone git@server.example.com:root/redhat-aap-extra-vars-eda.git
cp -rf redhat-eda-example/*  redhat-aap-extra-vars-eda/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>[ec2-user@node1 ~]$ cd 03-lab/
[ec2-user@node1 03-lab]$ git clone git@server.example.com:root/redhat-aap-extra-vars-eda.git
[ec2-user@node1 03-lab]$ cp -rf redhat-eda-example/*  redhat-aap-extra-vars-eda/</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Change directory to <em>redhat-aap-extra-vars-eda</em> and commit to git:</p>
</li>
</ul>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cd redhat-aap-extra-vars-eda/
git config --global user.name "ec2-user"
git config --global user.email ec2-user@localhost
git add .
git commit -m "Red Hat"
git push</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>[ec2-user@node1 03-lab]$ cd redhat-aap-extra-vars-eda/
[ec2-user@node1 redhat-aap-extra-vars-eda]$ git config --global user.name "ec2-user"
[ec2-user@node1 redhat-aap-extra-vars-eda]$ git config --global user.email ec2-user@localhost
[ec2-user@node1 redhat-aap-extra-vars-eda]$ git add .
[ec2-user@node1 redhat-aap-extra-vars-eda]$ git commit -m "Red Hat"
[ec2-user@node1 redhat-aap-extra-vars-eda]$ git push</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_now_in_automation_executioncontroller"><a class="anchor" href="#_now_in_automation_executioncontroller"></a>Now in Automation Execution(Controller):</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Login to Ansible Auotomaton Platform using the information provided on the RHDP page.</p>
</li>
<li>
<p>Create the inventory. Select menu -&#8594; Automation Execution -&#8594; Infrastructure -&#8594; Inventories.</p>
</li>
<li>
<p>To create the inventory, click on <strong>Create inventory</strong> in blue.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/create-inventory-001.jpg" target="_blank" rel="noopener"><img src="_images/create-inventory-001.jpg" alt="create-inventory-001" width="100%" height="100%"></a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Name: localhost
Organization: Default</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-002.jpg" target="_blank" rel="noopener"><img src="_images/lab003-002.jpg" alt="lab003-002" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Now click on <strong>Create inventory</strong>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To add a host to the inventory, click the on <strong>Hosts</strong> tab.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-003.jpg" target="_blank" rel="noopener"><img src="_images/lab003-003.jpg" alt="lab003-003" width="100%" height="100%"></a>
</div>
</div>
</li>
<li>
<p>Click on <strong>Create host</strong>:</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-004.jpg" target="_blank" rel="noopener"><img src="_images/lab003-004.jpg" alt="lab003-004" width="100%" height="100%"></a>
</div>
</div>
</li>
<li>
<p>Name: localhost</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-005.jpg" target="_blank" rel="noopener"><img src="_images/lab003-005.jpg" alt="lab003-005" width="100%" height="100%"></a>
</div>
</div>
</li>
<li>
<p>Click on <strong>Create host</strong>:</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next, create the <em>ec2-user</em> user credential in Ansible Automation Platform.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To create the machine credential in Ansible Automation Platform, we need to get the private key from the <strong>bastion</strong> host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The environment referenced in the lab document is using <em>.ssh/vkhtjkey.pem</em> as the SSH key. Your key will be named differently.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To validate your private key:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[lab-user@bastion ~]$ ls -lha .ssh/
total 24K
drwx------. 2 lab-user lab-user  102 Nov 19 02:24 .
drwxr-xr-x. 8 lab-user lab-user 4.0K Nov 19 12:41 ..
-rw-------. 1 lab-user lab-user 2.4K Nov 19 13:10 authorized_keys
-r--------. 1 lab-user root      216 Nov 19 01:40 config
-rw-r--r--. 1 lab-user lab-user  374 Nov 19 12:41 known_hosts
-r--------. 1 lab-user root     2.6K Nov 19 01:40 wlffskey.pem
-r--------. 1 lab-user root      552 Nov 19 01:40 wlffskey.pub
[lab-user@bastion ~]$
[lab-user@bastion ~]$ cat .ssh/vkhtjkey.pem</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the contents of the private key and create the machine credential:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Name: ec2-user
Organization: Default
credential type: Machine
Username: ec2-user
SSH Private Key: Copy your bastion private key: cat .ssh/vkhtjkey.pem</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-009.jpg" target="_blank" rel="noopener"><img src="_images/lab003-009.jpg" alt="lab003-009" width="100%" height="100%"></a>
</div>
</div>
</li>
<li>
<p>Confirm that you created the <em>ec2-user</em> user:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-010.jpg" target="_blank" rel="noopener"><img src="_images/lab003-010.jpg" alt="lab003-010" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the gitlab credential:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Name: gitlab
Organization: Default
credential type: Source Control
Username: root
SCM Private Key: Copy your bastion private key: cat .ssh/vkhtjkey.pem</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-011.jpg" target="_blank" rel="noopener"><img src="_images/lab003-011.jpg" alt="lab003-011" width="100%" height="100%"></a>
</div>
</div>
</li>
<li>
<p>Create a project in Ansible Automation Platform to sync the <em>redhat-aap-extra-vars-eda</em> project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Name: redhat-aap-extra-vars-eda
Organization: Default
credential control type: git
Source control URL: git@server.example.com:root/redhat-aap-extra-vars-eda.git
Source control credential: gitlab
check box:
  Clean
  Delete
  Update revision on launch</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-015.jpg" target="_blank" rel="noopener"><img src="_images/lab003-015.jpg" alt="lab003-015" width="100%" height="100%"></a>
</div>
</div>
</li>
<li>
<p>Now click on <strong>Create project</strong>:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the project finishes syncing, create the <strong>job_template</strong> in Ansible Automation Platform with the project name <em>redhat-aap-extra-vars-eda</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Name: redhat-aap-extra-vars-eda
Inventory: localhost
Project: redhat-aap-extra-vars-eda
Playbook: playbook/hello-redhat.yml
Credentials: ec2-user</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-add006.jpg" target="_blank" rel="noopener"><img src="_images/lab003-add006.jpg" alt="lab003-add006" width="100%" height="100%"></a>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_now_in_automation_decisions_event_driven_create_the_credential"><a class="anchor" href="#_now_in_automation_decisions_event_driven_create_the_credential"></a>Now in Automation Decisions (Event-Driven) create the credential:</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>To create the credential, select menu -&#8594; Automation Decisions -&#8594; Infrastructure -&#8594; Credentials -&#8594; Create credential :</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-017.jpg" target="_blank" rel="noopener"><img src="_images/lab003-017.jpg" alt="lab003-017" width="100%" height="100%"></a>
</div>
</div>
</li>
<li>
<p>Now add the credential information:</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-018.jpg" target="_blank" rel="noopener"><img src="_images/lab003-018.jpg" alt="lab003-018" width="100%" height="100%"></a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Name: gitlab
Organization: Default
Credential type: Source Control
Username: root
Password: redhat..123</code></pre>
</div>
</div>
</li>
<li>
<p>Create the project in Event-Driven:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select `Automation Decisions -&#8594; Projects and Click on <strong>Create project</strong>:</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-021.jpg" target="_blank" rel="noopener"><img src="_images/lab003-021.jpg" alt="lab003-021" width="100%" height="100%"></a>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create the project with the following information:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Name: redhat-aap-extra-vars-eda
Organization: Default
Source control type: git
Source control URL: https://server.example.com/root/redhat-aap-extra-vars-eda.git
Source control credential: gitlab
Disable verify SSL: Uncheck</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-020.jpg" target="_blank" rel="noopener"><img src="_images/lab003-020.jpg" alt="lab003-020" width="100%" height="100%"></a>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>NOTE:
 - The project does not sync. Find the error and resolve.
 -  Import error: The 'extensions/eda/rulebooks' or 'rulebooks' directory doesn&#8217;t exist within the project root.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-024.jpg" target="_blank" rel="noopener"><img src="_images/lab003-024.jpg" alt="lab003-024" width="100%" height="100%"></a>
</div>
</div>
<div class="paragraph">
<p>Next, under Automation Decisions &gt; Infrastructure &gt; Credentials, click Create credential</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Create credential</strong>:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-017.jpg" target="_blank" rel="noopener"><img src="_images/lab003-017.jpg" alt="lab003-017" width="100%" height="100%"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-018.jpg" target="_blank" rel="noopener"><img src="_images/lab003-018.jpg" alt="lab003-018" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Now add, the following to your credential:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Name: AAP
Organization: Default
Credential type: Red Hat Ansible Automation Platform
Red Hat Ansible Automation Platform: https://controller.example.com/api/controller/
Username: lab-user
Password: &lt;provide-lab-user-password-from-RHDP-login-page&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Create credential</strong>:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-027.jpg" target="_blank" rel="noopener"><img src="_images/lab003-027.jpg" alt="lab003-027" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create credential registry Red Hat.</p>
</li>
<li>
<p>Click in on <strong>Create credential</strong> in Automation Decisions:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-add007.png" target="_blank" rel="noopener"><img src="_images/lab003-add007.png" alt="lab003-add007" width="100%" height="100%"></a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Name: redhat
Organization: Default
Credential type: Container Registry
authentication URL: registry.redhat.io
username: &lt;your-Redhat-login&gt;
Password or Token: &lt;Your-RedHat-password&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-add008.png" target="_blank" rel="noopener"><img src="_images/lab003-add008.png" alt="lab003-add008" width="100%" height="100%"></a>
</div>
</div>
<div class="paragraph">
<p>Now edit Decision Environments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the three dots, then on <strong>Edit decision environment</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-add009.png" target="_blank" rel="noopener"><img src="_images/lab003-add009.png" alt="lab003-add009" width="100%" height="100%"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-add010.png" target="_blank" rel="noopener"><img src="_images/lab003-add010.png" alt="lab003-add010" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In credential, add <strong>redhat</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-add011.png" target="_blank" rel="noopener"><img src="_images/lab003-add011.png" alt="lab003-add011" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Save Decision Environment</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now create the Rulebook:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Rulebook will not be able to be located. You need to resolve this issue.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Under Automation Decisions -&#8594; Rulebook Activations click on -&#8594; Create rulebook activation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Name: redhat-aap-extra-vars-eda
Organization: Default
Project: redhat-aap-extra-vars-eda
Rulebook: webhook-example.yml
Credential: AAP
Decision environment: Default Decision Environment</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-025.jpg" target="_blank" rel="noopener"><img src="_images/lab003-025.jpg" alt="lab003-025" width="100%" height="100%"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-028.jpg" target="_blank" rel="noopener"><img src="_images/lab003-028.jpg" alt="lab003-028" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Create rulebook activation</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now the activation should show as <strong>Running</strong>:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-032.jpg" target="_blank" rel="noopener"><img src="_images/lab003-032.jpg" alt="lab003-032" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the rulebook: <em>redhat-aap-extra-vars-eda</em></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-033.jpg" target="_blank" rel="noopener"><img src="_images/lab003-033.jpg" alt="lab003-033" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Next go to the on <strong>History</strong> tab:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-034.jpg" target="_blank" rel="noopener"><img src="_images/lab003-034.jpg" alt="lab003-034" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the rulebook that is in Running:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-035.jpg" target="_blank" rel="noopener"><img src="_images/lab003-035.jpg" alt="lab003-035" width="100%" height="100%"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Now send the <strong>curl</strong> to this rulebook:</p>
</li>
</ul>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">ssh node1
curl -H 'Content-Type: application/json' -d '{"event_name": "Hello", "host_host": "node1.example.com" }' controller:6000/endpoint</code></pre>
</div>
</div>
<div class="paragraph">
<p>After sending the curl. The Job Template <em>redhat-aap-extra-vars-eda</em> will run.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need to resolve this error:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>fatal: [localhost]: FAILED! =&gt; {"msg": "'hosts_update' is undefined. 'hosts_update' is undefined"}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need to resolve this error:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>fatal: [localhost]: UNREACHABLE! =&gt; {"changed": false, "msg": "Failed to connect to the host via ssh: ssh: connect to host localhost port 22: Connection refused", "unreachable": true}</pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>PAUSE</strong></p>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_before_moving_ahead"><a class="anchor" href="#_before_moving_ahead"></a>Before moving ahead</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_please_take_a_moment_to_solve_the_challenge_on_your_own"><a class="anchor" href="#_please_take_a_moment_to_solve_the_challenge_on_your_own"></a>Please take a moment to solve the challenge on your own.</h3>
<div class="paragraph">
<p><strong>The real value of this activity lies in your effort to troubleshoot independently.</strong></p>
</div>
<div class="paragraph">
<p><strong>Once you have tried, continue to the next section for guided steps to verify your approach or learn an alternate solution.</strong></p>
</div>
<hr>
<div class="paragraph">
<p><strong>CONTINUE</strong></p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guided_solution"><a class="anchor" href="#guided_solution"></a>Guided solution</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab03-erro-lab.png" target="_blank" rel="noopener"><img src="_images/lab03-erro-lab.png" alt="lab03-erro-lab" width="100%" height="100%"></a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The rulebook folder name is missing the S:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[ec2-user@node1 ~]$ cd 03-lab/
[ec2-user@node1 03-lab]$ ls
redhat-aap-extra-vars-eda  redhat-eda-example
[ec2-user@node1 03-lab]$ cd redhat-aap-extra-vars-eda/
[ec2-user@node1 redhat-aap-extra-vars-eda]$ ls
playbook  README.md  rulebook
[ec2-user@node1 redhat-aap-extra-vars-eda]$ mv rulebook rulebooks
[ec2-user@node1 redhat-aap-extra-vars-eda]$ git add .
[ec2-user@node1 redhat-aap-extra-vars-eda]$ git commit -m add
[ec2-user@node1 redhat-aap-extra-vars-eda]$ git push</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable host in inventory:</p>
<div class="literalblock">
<div class="content">
<pre>Go back to the inventory and disable the host:</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-007.jpg" target="_blank" rel="noopener"><img src="_images/lab003-007.jpg" alt="lab003-006" width="100%" height="100%"></a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove <code>remote_user: root</code> the playbook <em>hello-redhat.yml</em>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[ec2-user@node1 ~]$ cd 03-lab/
[ec2-user@node1 03-lab]$ ls
redhat-aap-extra-vars-eda  redhat-eda-example
[ec2-user@node1 03-lab]$ cd redhat-aap-extra-vars-eda/
[ec2-user@node1 redhat-aap-extra-vars-eda]$ ls
playbook  README.md  rulebooks
[ec2-user@node1 redhat-aap-extra-vars-eda]$ vim playbook/hello-redhat.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the file.</p>
</div>
<div class="paragraph">
<p>To resolve this issue:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
fatal: [localhost]: FAILED! &#8658; {"msg": "'hosts_update' is undefined. 'hosts_update' is undefined"}
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Make this configuration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In job_template <em>redhat-aap-extra-vars-eda</em>, enable <strong>Prompt on launch</strong> in Extra variables.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/lab003-add013.png" target="_blank" rel="noopener"><img src="_images/lab003-add013.png" alt="lab003-add013" width="100%" height="100%"></a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Now, send the <strong>curl</strong> command:</p>
</li>
</ol>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">ssh node1
curl -H 'Content-Type: application/json' -d '{"event_name": "Hello", "host_host": "node1.example.com" }' controller:6000/endpoint</code></pre>
</div>
</div>
<div class="paragraph">
<p>After sending the <strong>curl</strong>. The Job Template <em>redhat-aap-extra-vars-eda</em> will run.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="section2.html">Troubleshoot rulebook using CURL and extra_vars</a></span>
  <span class="next"><a href="section4.html">Configure Event-Driven to pass extra variables to Ansible Automation Platform</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
